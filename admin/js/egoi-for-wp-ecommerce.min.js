jQuery(document).ready(function(){!function(t){const o="idgoi";var e,a,c=0,i=0,n=300,l=t("#delete_catalog_loader"),s=t("#egoi-loader-products"),r=t("#importModal"),d=t("#confirmDeleteModal"),g=t(".sync_catalog"),u=t(".variations_catalog"),_=t(".force_catalog"),p=t("#force_catalog_glob"),h=t("#catalog_glob_status"),f=t(".remove_catalog"),m=t("#new_catalog_page"),v=egoi_config_ajax_object_ecommerce,x=(t(".smsnf-table >tbody"),t("#selected-import-catalog")),w=t("#display-selected"),y=t("#start-import-catalog"),b=t("#display-number-products"),j=t("#egoi-left-products"),k=t("#loading-import"),I=t("#progressbar-import"),M=t("#selected-delete-catalog"),R=t("#verified-delete-catalog"),Q=t("#verified-delete-catalog-span"),C=t("#egoi-success"),D=t("#egoi-success-message"),J=t("#egoi-alert"),N=t("#egoi-alert-message"),O=t(".egoi-simple-close-x"),S=t("#close_modal_catalog"),T=t("#cancel_modal_catalog");function q(o){s.show(),b.text(""),j.text(""),t.get(v.ajax_url,{action:"egoi_count_products",catalog:o},function(t){if(s.hide(),!1===(t=A(t)))return!1;b.text(t),j.text(t),c=0,i=Math.ceil(parseInt(t)/100),y.attr("disabled",!1)})}function z(e,a=""){if(c>=i)return setTimeout(function(){var t;h.val(1),h.trigger("change"),k.hide(n),B(),r.modal("toggle"),t=a,D.text(t),C.show(n)},1e3),g.each(function(){t(this).attr(o)==e&&(t(this).prop("checked",!0),t(this).trigger("change"))}),!0;var l={security:v.ajax_nonce,action:"egoi_force_import_catalog",id:e,page:c++};t.post(v.ajax_url,l,function(t){if(!1===(t=A(t)))return!1;var o;0==i&&(i=1),function(t){var o=I.width()/I.parent().width()*100;console.log("adding %s percent. now %s",t,o),parseInt(o)+t>=100?t=100:t+=o;I.width(t+"%")}(1/i*100),o=parseInt(j.text()),(o-=100)<0&&(o=0),j.text(o),z(e,t)})}function A(t){var o,e;return void 0!==(t="string"==typeof(o=t)?JSON.parse(o):o).success&&!1===t.success?(e=t.data,N.text(e),console.error(e),J.show(n),r.modal("hide"),!1):t.data}function B(){I.css("width","0%")}S.on("click",function(){d.modal("hide")}),T.on("click",function(){d.modal("hide")}),g.change(function(){var a;!function(o,a){var c={security:v.ajax_nonce,action:"egoi_sync_catalog",data:o};void 0!==e&&e.abort();l.show(),t(a).attr("disabled",!0),e=t.post(v.ajax_url,c,function(o){return l.hide(),t(a).attr("disabled",!1),!1!==(o=A(o))})}((a=[],g.each(function(){t(this).is(":checked")&&a.push(t(this).attr(o))}),a))}),u.change(o=>{o=t(o.target),console.log(o[0].checked);let e={security:v.ajax_nonce,action:"egoi_variations_catalog",catalog_id:o.attr("idgoi"),status:o[0].checked};t.post(v.ajax_url,e,function(t){console.log("saved")})}),t(document).on("change",".related_products_catalog",function(o){const e=(o=t(o.target)).attr("idgoi"),a=o[0].checked;console.log("Related products toggle changed:",a);const c=t('select.related_products_type_catalog[idgoi="'+e+'"]');a?c.prop("disabled",!1):c.prop("disabled",!0);let i={security:v.ajax_nonce,action:"egoi_related_products_catalog",catalog_id:e,status:a?"true":"false"};t.post(v.ajax_url,i,function(t){console.log("Related products toggle saved:",t)})}),t(document).on("change",".related_products_type_catalog",function(o){const e=(o=t(o.target)).attr("idgoi"),a=o.val();let c={security:v.ajax_nonce,action:"egoi_related_products_type_catalog",catalog_id:e,type:a};t.post(v.ajax_url,c,function(t){console.log("Related products type saved")})}),R.on("click",function(){!function(o,e){console.log("deleting catalog: "+o);var a={security:v.ajax_nonce,action:"egoi_delete_catalog",id:o};l.show(),Q.hide(),t(e).attr("disabled",!0),t.post(v.ajax_url,a,function(o){if(l.hide(),Q.show(),t(e).attr("disabled",!1),o=A(o),console.log(o),!1===o)return!1;d.modal("hide"),location.reload()})}(M.val(),a)}),r.on("hidden.bs.modal",function(){y.attr("disabled",!0),B(),k.hide()}),p.on("click",e=>{let a=t(e.target).attr(o);a&&(x.val(a),w.text(a),q(a),r.modal("show"))}),_.on("click",function(){var e=t(this);e.removeClass("egoi-pulsating"),t(".smsnf-notification").hide(n);var a=e.attr(o);x.val(a),w.text(a),q(a),r.modal("show")}),y.on("click",function(){y.attr("disabled",!0),k.show(),z(x.val()),console.log("importing catalog: "+x.val())}),f.on("click",function(){M.val(t(this).attr(o)),d.modal("show"),a=this}),O.on("click",function(){t(t(t(this).parent()[0]).parent()[0]).hide()}),m.on("click",function(){window.location.href=window.location.href+"&subpage=new_catalog"})}(jQuery)});