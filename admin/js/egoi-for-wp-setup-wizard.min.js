!function(a){let e={subscribers:["#list"],cs:["#domain"],products:["#catalog"],tweaks:[]},t=["subscribers","cs","tweaks"];a(document).ready(function(){var l=a(".egoi-modal-header>.close"),o=a("#next_step"),i=a(".nav-link"),n=a("#egoi-loader"),c=a("#create_catalog"),r=a("#createCatalogModal"),s=a("#create_catalog_button"),d=a("#force_catalog_glob"),u=a("#catalog_glob_status"),g=a("#catalog"),p=a("#list"),f=a("#role"),v=a("#selected-import-catalog"),$=a("#loading-subs-import"),h=a("#progressbar-subs-import"),b=0,m=a("#subs-progress");function k(a){a>=100&&(a=100),h.width(a+"%")}async function y(e,t){let l={security:egoi_config_ajax_object_core.ajax_nonce,action:"egoi_wizard_step",step:e};return Object.entries(t).forEach(([a,e])=>{l[a]=e}),console.log(l),a.post(egoi_config_ajax_object_core.ajax_url,l)}function _(a){k(a/b*100),m.text(`${a} of ${b} subscribers`)}function x(){o.attr("disabled",!1),p.attr("disabled",!1),f.attr("disabled",!1),_(b),n.hide(),setTimeout(()=>{o.trigger("click"),setTimeout(()=>{$.css("display","none")},0)},1e3)}function w(e){n.show();let t={action:"egoi_count_subs",security:egoi_config_ajax_object_core.ajax_nonce,role:e};a.post(egoi_config_ajax_object_core.ajax_url,t,a=>{n.hide(),a.data.wp&&(b=a.data.wp,_(0))})}n.show(),l.on("click",e=>{a(a(a(a(a(e.target).parent()[0]).parent()[0]).parent()[0]).parent()[0]).modal("hide")}),c.on("click",function(a){a.preventDefault(),r.modal("show")}),u.on("change",e=>{a(e.target).val()&&o.trigger("click")}),s.on("click",function(e){e.preventDefault();let t={security:egoi_config_ajax_object_ecommerce.ajax_nonce,action:"egoi_create_catalog"},l=a("#form-create-catalog").serializeArray();for(let o=0;o<l.length;o++){if(!l[o].value)return;t[l[o].name]=l[o].value}n.show(),a.post(egoi_config_ajax_object_ecommerce.ajax_url,t,function(e){n.hide(),g.length&&g.append('<option selected value="'+e.data.catalog_id+'">'+e.data.catalog_name+"</option>"),v.val(e.data.catalog_id),a("#display-selected").text(e.data.catalog_name),r.modal("hide"),d.attr("idgoi",e.data.catalog_id),d.trigger("click")})}),o.on("click",function(){let l=!1;i.each((i,c)=>{if(c=a(c),l)return c.prop("disabled",!1),c.click(),!1;if(c.hasClass("active")){var r,s;let h=c[0].id.replaceAll("v-pills-","").replaceAll("-tab",""),b,m;r=h,b=!0,e[r].forEach(e=>{var t;let l=a(e);switch(r){case"cs":if(!a("input[name='egoi_sync[track]']")[0].checked)return;break;case"subscribers":if(p.val()&&"none"===$.css("display")){y(r,{list:p.val(),role:f.val()}).then(e=>{k(0),o.attr("disabled",!0),p.attr("disabled",!0),f.attr("disabled",!0),$.css("display","block"),n.show(),_(0),function e(t){let l={security:egoi_config_ajax_object_core.ajax_nonce,action:"egoi_synchronize_subs",page:0};a.post(egoi_config_ajax_object_core.ajax_url,l,function(a){a.success||(console.log(a.data),x()),a.data&&a.data.next?(_(a.data.done),e(a.data.next)):x()})}(0)}),b=!1;return}break;case"products":if(g.val()&&!u.val()||g.val()&&g.val()!==v.val()){v.val(g.val()),d.attr("idgoi",g.val()),d.trigger("click"),b=!1;return}if(u.val())return;if(0==a("#force_catalog_glob").length){b=!0;return}}l.val()&&""!=l.val()&&0!=l.val()&&"off"!=l.val()||(b=!1,(t=l).addClass("invalidjQuery"),setTimeout(function(){t.removeClass("invalidjQuery")},2e3))}),b&&(t.includes(h)&&(console.log("time to send"),y(h,(s=a("#form-"+h).serializeArray(),m={},s.forEach(a=>{a.name=a.name.replaceAll("egoi_sync[","").replaceAll("]",""),m[a.name]=a.value}),m))),c.html().includes("✅")||(c.append("</span>✅</span>"),h==t[t.length-1]&&setTimeout(()=>{window.location.href="?page=egoi-4-wp-subscribers"},1e3)),l=!0)}})}),f.on("change",e=>{w((e=a(e.target)).val())}),p.on("change",()=>{w(f.val())}),a.post(url_egoi_script.ajaxurl,{action:"egoi_get_lists"},function(e){n.hide();var t=JSON.parse(e);a.each(t,function(e,t){t.listnum&&a("#list").append(`<option value = "${t.listnum}"> ${t.title} </option>`)})}),w("")})}(jQuery);