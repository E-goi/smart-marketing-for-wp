!function(a){let e={subscribers:["#list"],cs:["#domain"],products:["#catalog"],tweaks:[]},t=["subscribers","cs","tweaks"];a(document).ready(function(){var l=a(".egoi-modal-header>.close"),i=a("#next_step"),o=a(".nav-link"),c=a("#egoi-loader"),n=a("#create_catalog"),r=a("#createCatalogModal"),s=a("#create_catalog_button"),d=a("#force_catalog_glob"),u=a("#catalog_glob_status"),g=a("#catalog"),p=a("#list"),f=a("#role"),v=a("#selected-import-catalog"),$=a("#loading-subs-import"),b=a("#progressbar-subs-import"),h=0,m=a("#subs-progress");function k(a){a>=100&&(a=100),b.width(a+"%")}async function y(e,t){let l={security:egoi_config_ajax_object_core.ajax_nonce,action:"egoi_wizard_step",step:e};return Object.entries(t).forEach(([a,e])=>{l[a]=e}),a.post(egoi_config_ajax_object_core.ajax_url,l)}function _(a){k(a/h*100),m.text(`${a} of ${h} subscribers`)}function x(){i.attr("disabled",!1),p.attr("disabled",!1),f.attr("disabled",!1),_(h),c.hide(),setTimeout(()=>{i.trigger("click"),setTimeout(()=>{$.css("display","none")},0)},1e3)}function w(e){c.show();let t={action:"egoi_count_subs",security:egoi_config_ajax_object_core.ajax_nonce,role:e};a.post(egoi_config_ajax_object_core.ajax_url,t,a=>{c.hide(),a.data.wp&&(h=a.data.wp,_(0))})}c.show(),l.on("click",e=>{a(a(a(a(a(e.target).parent()[0]).parent()[0]).parent()[0]).parent()[0]).modal("hide")}),n.on("click",function(a){a.preventDefault(),r.modal("show")}),u.on("change",e=>{a(e.target).val()&&i.trigger("click")}),s.on("click",function(e){e.preventDefault();let t={security:egoi_config_ajax_object_ecommerce.ajax_nonce,action:"egoi_create_catalog"},l=a("#form-create-catalog").serializeArray();for(let i=0;i<l.length;i++){if(!l[i].value)return;t[l[i].name]=l[i].value}c.show(),a.post(egoi_config_ajax_object_ecommerce.ajax_url,t,function(e){c.hide(),g.length&&g.append('<option selected value="'+e.data.catalog_id+'">'+e.data.catalog_name+"</option>"),v.val(e.data.catalog_id),a("#display-selected").text(e.data.catalog_name),r.modal("hide"),d.attr("idgoi",e.data.catalog_id),d.trigger("click")})}),i.on("click",function(){let l=!1;o.each((o,n)=>{if(n=a(n),l)return n.prop("disabled",!1),n.click(),!1;if(n.hasClass("active")){var r,s;let b=n[0].id.replaceAll("v-pills-","").replaceAll("-tab",""),h,m;r=b,h=!0,e[r].forEach(e=>{var t;let l=a(e);switch(r){case"cs":if(!a("input[name='egoi_sync[track]']")[0].checked)return;break;case"subscribers":if(p.val()&&"none"===$.css("display")){y(r,{list:p.val(),role:f.val()}).then(e=>{k(0),i.attr("disabled",!0),p.attr("disabled",!0),f.attr("disabled",!0),$.css("display","block"),c.show(),_(0),function e(t){let l={security:egoi_config_ajax_object_core.ajax_nonce,action:"egoi_synchronize_subs",page:0};a.post(egoi_config_ajax_object_core.ajax_url,l,function(a){a.success||x(),a.data&&a.data.next?(_(a.data.done),e(a.data.next)):x()})}(0)}),h=!1;return}break;case"products":if(g.val()&&!u.val()||g.val()&&g.val()!==v.val()){v.val(g.val()),d.attr("idgoi",g.val()),d.trigger("click"),h=!1;return}if(u.val())return;if(0==a("#force_catalog_glob").length){h=!0;return}}l.val()&&""!=l.val()&&0!=l.val()&&"off"!=l.val()||(h=!1,(t=l).addClass("invalidjQuery"),setTimeout(function(){t.removeClass("invalidjQuery")},2e3))}),h&&(t.includes(b)&&y(b,(s=a("#form-"+b).serializeArray(),m={},s.forEach(a=>{a.name=a.name.replaceAll("egoi_sync[","").replaceAll("]",""),m[a.name]=a.value}),m)),n.html().includes("✅")||(n.append("</span>✅</span>"),b==t[t.length-1]&&setTimeout(()=>{window.location.href="?page=egoi-4-wp-subscribers"},1e3)),l=!0)}})}),f.on("change",e=>{w((e=a(e.target)).val())}),p.on("change",()=>{w(f.val())}),a.post(url_egoi_script.ajaxurl,{action:"egoi_get_lists"},function(e){c.hide();var t=JSON.parse(e);a.each(t,function(e,t){t.list_id&&a("#list").append(`<option value = "${t.list_id}"> ${t.public_name} </option>`)})}),w("")})}(jQuery);