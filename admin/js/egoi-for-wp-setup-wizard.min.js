!function(a){const e={subscribers:["#list"],cs:["#domain"],products:["#catalog"],tweaks:[]},t=["subscribers","cs","tweaks"];a(document).ready(function(){var o=a(".egoi-modal-header>.close"),i=a("#next_step"),c=a(".nav-link"),l=a("#egoi-loader"),n=a("#create_catalog"),r=a("#createCatalogModal"),s=a("#create_catalog_button"),d=a("#force_catalog_glob"),g=a("#catalog_glob_status"),u=a("#catalog"),_=a("#list"),p=a("#role"),f=a("#selected-import-catalog"),v=a("#loading-subs-import"),b=a("#progressbar-subs-import"),h=0,j=-1,m=a("#subs-progress");function x(a){a>=100&&(a=100),b.width(a+"%")}async function k(e,t){let o={security:egoi_config_ajax_object_core.ajax_nonce,action:"egoi_wizard_step",step:e};return Object.entries(t).forEach(([a,e])=>{o[a]=e}),a.post(egoi_config_ajax_object_core.ajax_url,o)}function y(a){x(a/h*100),m.text(`${a} of ${h} subscribers`)}function w(e){let t={security:egoi_config_ajax_object_core.ajax_nonce,action:"egoi_synchronize_subs",page:e};a.post(egoi_config_ajax_object_core.ajax_url,t,function(a){a.success||A(),a.data&&a.data.next?(y(a.data.done),w(a.data.next)):A()})}function A(){i.attr("disabled",!1),_.attr("disabled",!1),p.attr("disabled",!1),y(h),l.hide(),setTimeout(()=>{i.trigger("click"),setTimeout(()=>{v.css("display","none")},0)},1e3)}function z(e){l.show();let t={action:"egoi_count_subs",security:egoi_config_ajax_object_core.ajax_nonce,role:e};a.post(egoi_config_ajax_object_core.ajax_url,t,a=>{l.hide(),a.data.wp&&(h=a.data.wp,y(0))})}l.show(),o.on("click",e=>{a(a(a(a(a(e.target).parent()[0]).parent()[0]).parent()[0]).parent()[0]).modal("hide")}),n.on("click",function(a){a.preventDefault(),r.modal("show")}),g.on("change",e=>{a(e.target).val()&&i.trigger("click")}),s.on("click",function(e){e.preventDefault();let t={security:egoi_config_ajax_object_ecommerce.ajax_nonce,action:"egoi_create_catalog"},o=a("#form-create-catalog").serializeArray();for(let a=0;a<o.length;a++){if(!o[a].value)return;t[o[a].name]=o[a].value}l.show(),a.post(egoi_config_ajax_object_ecommerce.ajax_url,t,function(e){l.hide(),u.length&&u.append('<option selected value="'+e.data.catalog_id+'">'+e.data.catalog_name+"</option>"),f.val(e.data.catalog_id),a("#display-selected").text(e.data.catalog_name),r.modal("hide"),d.attr("idgoi",e.data.catalog_id),d.trigger("click")})}),i.on("click",function(){let o=!1;c.each((c,n)=>{if(n=a(n),o)return n.prop("disabled",!1),n.click(),!1;if(n.hasClass("active")){let c=n[0].id.replaceAll("v-pills-","").replaceAll("-tab",""),r=function(t){let o=!0;return e[t].forEach(e=>{let c=a(e);switch(t){case"cs":if(!a("input[name='egoi_sync[track]']")[0].checked)return;break;case"subscribers":if(0===h)return;if(_.val()&&"none"===v.css("display"))return k(t,{list:_.val(),role:p.val()}).then(a=>{x(0),i.attr("disabled",!0),_.attr("disabled",!0),p.attr("disabled",!0),v.css("display","block"),l.show(),y(0),w(0)}),void(o=!1);break;case"products":if(0==a("#force_catalog_glob").length)return void(o=!0);if(u.val()&&!g.val()||u.val()&&u.val()!==f.val())return-1===j?(l.show(),a.get(egoi_config_ajax_object_ecommerce.ajax_url,{action:"egoi_count_products",catalog:u.val()},function(a){l.hide(),a.success&&a.data&&(0===(j=parseInt(a.data))?(g.val(1),i.trigger("click")):(f.val(u.val()),d.attr("idgoi",u.val()),d.trigger("click")))}),void(o=!1)):0===j?void 0:(f.val(u.val()),d.attr("idgoi",u.val()),d.trigger("click"),void(o=!1));if(g.val())return}var n;c.val()&&""!=c.val()&&0!=c.val()&&"off"!=c.val()||(o=!1,(n=c).addClass("invalidjQuery"),setTimeout(function(){n.removeClass("invalidjQuery")},2e3))}),o}(c);r&&(t.includes(c)&&k(c,function(a){let e={};return a.forEach(a=>{a.name=a.name.replaceAll("egoi_sync[","").replaceAll("]",""),e[a.name]=a.value}),e}(a("#form-"+c).serializeArray())),n.html().includes("✅")||(n.append("</span>✅</span>"),c==t[t.length-1]&&setTimeout(()=>{window.location.href="?page=egoi-4-wp-subscribers"},1e3)),o=!0)}})}),p.on("change",e=>{z((e=a(e.target)).val())}),_.on("change",()=>{z(p.val())}),a.post(url_egoi_script.ajaxurl,{action:"egoi_get_lists"},function(e){l.hide();var t=JSON.parse(e);a.each(t,function(e,t){t.list_id&&a("#list").append(`<option value = "${t.list_id}"> ${t.public_name} </option>`)})}),z("")})}(jQuery);